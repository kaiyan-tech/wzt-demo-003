# 快速开始

## 三步创建新项目

```bash
# 1. 克隆模板
git clone https://github.com/kaiyan-tech/ky-framework.git my-project

# 2. 进入目录
cd my-project

# 3. 运行初始化脚本
./scripts/setup.sh
```

脚本会引导你完成：

- Git 历史重置
- 本地开发环境配置（Docker PostgreSQL）
- 阿里云资源创建（OSS、FC）
- GitHub 仓库创建和 Secrets 配置
- 首次部署和 CI/CD 触发

## 前置条件

| 工具            | 版本要求 | 安装方式                                                     |
| --------------- | -------- | ------------------------------------------------------------ |
| Node.js         | ≥ 22     | [nodejs.org](https://nodejs.org/)                            |
| pnpm            | ≥ 10     | `npm install -g pnpm`                                        |
| Docker          | 最新版   | [docker.com](https://www.docker.com/products/docker-desktop) |
| GitHub CLI      | 最新版   | `brew install gh` + `gh auth login`                          |
| Serverless Devs | 最新版   | 自动安装                                                     |
| 阿里云 CLI      | 最新版   | `brew install aliyun-cli`                                    |

## 使用配置文件（推荐）

在运行初始化脚本前，可以预先填写配置文件，避免交互式输入：

```bash
# 1. 复制配置模板
cp scripts/setup.env scripts/setup.env

# 2. 编辑配置文件，填写参数
vim scripts/setup.env

# 3. 运行初始化脚本（自动读取配置）
./scripts/setup.sh
```

配置文件示例：

```bash
# scripts/setup.env
PROJECT_NAME=my-project
GITHUB_ORG=your-org
REGION=cn-shenzhen

# 云端配置
ALIYUN_ACCESS_KEY_ID=LTAI5t***
ALIYUN_ACCESS_KEY_SECRET=***
DATABASE_URL=postgresql://user:pass@host:5432/db
VPC_ID=vpc-xxx
VSWITCH_ID=vsw-xxx
SECURITY_GROUP_ID=sg-xxx

# 仅本地开发时设为 true
SKIP_CLOUD=false
```

**配置优先级**：命令行参数 > 配置文件 > 交互式输入

> 配置文件中留空的参数会在运行时交互式询问

## 命令行参数

支持全自动化（无交互）：

```bash
./scripts/setup.sh \
  --name my-project \
  --github-org your-org \
  --ak-id LTAI5t*** \
  --ak-secret *** \
  --db-url "postgresql://user:pass@host:5432/db" \
  --region cn-shenzhen \
  --vpc-id vpc-xxx \
  --vsw-id vsw-xxx \
  --sg-id sg-xxx
```

### 参数说明

| 参数           | 必填 | 说明                              |
| -------------- | ---- | --------------------------------- |
| `--name`       | 是   | 项目名称                          |
| `--github-org` | 是   | GitHub 组织/用户名                |
| `--ak-id`      | 是   | 阿里云 AccessKey ID               |
| `--ak-secret`  | 是   | 阿里云 AccessKey Secret           |
| `--db-url`     | 是   | 生产数据库连接串                  |
| `--region`     | 否   | 阿里云地域（默认 cn-shenzhen）    |
| `--oss-bucket` | 否   | OSS Bucket 名称（默认使用项目名） |
| `--vpc-id`     | 否   | VPC ID（FC 访问 RDS 需要）        |
| `--vsw-id`     | 否   | VSwitch ID                        |
| `--sg-id`      | 否   | 安全组 ID                         |

### 控制选项

| 选项              | 说明                       |
| ----------------- | -------------------------- |
| `--skip-cloud`    | 跳过云端部署，仅本地初始化 |
| `--skip-local-db` | 跳过本地数据库初始化       |
| `--help`          | 显示帮助信息               |

## 仅本地开发

如果暂时不需要云端部署：

```bash
./scripts/setup.sh --skip-cloud
```

这会：

- 重置 Git 历史
- 安装依赖
- 初始化本地 Docker PostgreSQL
- 创建默认账号（admin@example.com / admin123）

之后运行 `pnpm dev` 即可开始开发。

## 初始化完成后

### 本地开发

```bash
pnpm dev              # 启动前后端
pnpm dev:frontend     # 仅前端 (localhost:5173)
pnpm dev:backend      # 仅后端 (localhost:3000)
```

### 数据库管理

| 命令              | 说明          |
| ----------------- | ------------- |
| `pnpm db:start`   | 启动数据库    |
| `pnpm db:stop`    | 停止数据库    |
| `pnpm db:reset`   | 重置数据库    |
| `pnpm db:studio`  | Prisma Studio |
| `pnpm db:migrate` | 创建迁移      |
| `pnpm db:seed`    | 执行种子数据  |

### 默认账号

- 邮箱：`admin@example.com`
- 密码：`admin123`

## 阿里云资源准备

在运行初始化前，需要在阿里云控制台准备：

| 资源           | 说明                           |
| -------------- | ------------------------------ |
| AccessKey      | RAM 用户的 AK/SK               |
| RDS PostgreSQL | 生产数据库（建议 17.x）        |
| VPC + VSwitch  | 网络（RDS 和 FC 需在同一 VPC） |
| 安全组         | 允许 FC 访问 RDS 端口          |

> OSS Bucket 和 FC 函数由脚本自动创建

## 已有项目的本地初始化

如果项目已经创建过，只需要初始化本地开发环境：

```bash
# 使用原有的 init.sh（仅本地开发）
./init.sh

# 或使用 pnpm 命令
pnpm install
pnpm db:setup
```

## 相关文档

- [数据库迁移规则](./数据库迁移规则.md)
- [开沿核心技术宪章](./开沿核心技术宪章.md) - 架构设计
- [开沿工程指导手册](./开沿工程指导手册.md) - 开发规范
